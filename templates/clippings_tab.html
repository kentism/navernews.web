<div class="clipping-text-wrapper" style="padding: 12px; border-bottom: 2px solid #eee; margin-bottom: 12px;">
    <h3 style="margin-bottom: 10px;">í´ë¦¬í•‘ í…ìŠ¤íŠ¸</h3>
    <textarea id="clippingTextArea"
        style="width: 100%; min-height: 400px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; line-height: 1.6;"
        title="í…ìŠ¤íŠ¸ ì˜ì—­ì˜ í¬ê¸°ë¥¼ ì¡°ì •í•˜ë ¤ë©´ ì˜¤ë¥¸ìª½ í•˜ë‹¨ì˜ í•¸ë“¤ì„ ë“œë˜ê·¸í•˜ì„¸ìš”."></textarea>
    <div style="margin-top: 10px; display: flex; gap: 10px;">
        <button id="copyTextBtn"
            style="padding: 8px 16px; background: #667eea; color: #fff; border: none; border-radius: 4px; cursor: pointer;">ğŸ“‹
            í…ìŠ¤íŠ¸ ë³µì‚¬</button>
        <button id="clearTextBtn"
            style="padding: 8px 16px; background: #f0f0f0; color: #333; border: none; border-radius: 4px; cursor: pointer;">âœ¨
            ë¹„ìš°ê¸°</button>
    </div>
</div>

<div class="clipping-list-wrapper" style="padding: 0 12px 12px 12px;">
    {% if clips %}
    <div style="padding-top:12px; margin-bottom:12px; border-bottom:2px solid #eee;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3 style="margin: 0;">ì €ì¥ëœ í´ë¦¬í•‘ ({{ clips|length }}ê°œ)</h3>
            <button onclick="deleteAllClips()"
                style="padding:8px 16px; background:#ff6b6b; color:#fff; border:none; border-radius:4px; cursor:pointer; font-weight:600;">
                ğŸ—‘ï¸ ëª¨ë‘ ì‚­ì œ
            </button>
        </div>
    </div>
    <div class="news-list">
        {% for clip_id, clip in clips.items() %}
        <div class="news-item" style="cursor: default; border-left-color: #ffd700;">
            <div class="news-content">
                <h3>{{ clip.title }}</h3>
                <p>{{ clip.content[:200] }}...</p>
                <div class="news-meta">
                    <span>í´ë¦¬í•‘ ì¼ì‹œ: {{ clip.created_at }}</span>
                </div>
            </div>
            <div class="news-actions">
                <a href="{{ clip.url }}" target="_blank" class="btn-small btn-detail">ì›ë¬¸ ë³´ê¸°</a>
                <button onclick="deleteClip('{{ clip_id }}')" class="btn-small btn-delete">ì‚­ì œ</button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div
        style="padding:40px 20px; text-align:center; color:#999; min-height:200px; display:flex; align-items:center; justify-content:center;">
        <p>ì €ì¥ëœ í´ë¦¬í•‘ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    </div>
    {% endif %}
</div>

<script>
    // ì´ ìŠ¤í¬ë¦½íŠ¸ ë¸”ë¡ì€ loadClippingsTab()ì— ì˜í•´ ë™ì ìœ¼ë¡œ ì‚½ì…ë˜ë¯€ë¡œ, ì „ì—­ ìŠ¤ì½”í”„ì— í•¨ìˆ˜ë¥¼ ë‹¤ì‹œ í• ë‹¹í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.
    // ë‹¨, ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” ì´ ì‹œì ì— ë°”ì¸ë”©í•´ì•¼ í•©ë‹ˆë‹¤.

    // â­â­â­ 1ë²ˆ ë¬¸ì œ (í´ë¦¬í•‘ í…ìŠ¤íŠ¸ ì´ˆê¸°í™”) ë³´ì™„ ë¶€ë¶„ â­â­â­
    const textArea = document.getElementById('clippingTextArea');
    if (textArea && window.clippedTextContent !== undefined) {
        textArea.value = window.clippedTextContent;
    }
    // â­â­â­ ë³´ì™„ ë â­â­â­

    document.getElementById('copyTextBtn')?.addEventListener('click', () => {
        const textArea = document.getElementById('clippingTextArea');
        if (!textArea || !textArea.value) return;

        // ìµœì‹  Clipboard API (HTTPS, localhostì—ì„œë§Œ ë™ì‘)
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(textArea.value)
                .then(() => window.showToast('í´ë¦¬í•‘ í…ìŠ¤íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'))
                .catch(err => {
                    console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
                    window.showToast('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                });
        } else {
            // êµ¬í˜• ë°©ì‹ (HTTPì—ì„œë„ ë™ì‘í•˜ëŠ” ëŒ€ì²´ ìˆ˜ë‹¨)
            try {
                textArea.select(); // í…ìŠ¤íŠ¸ ì „ì²´ ì„ íƒ
                textArea.setSelectionRange(0, 99999); // ëª¨ë°”ì¼ ê¸°ê¸° í˜¸í™˜ì„±
                document.execCommand('copy'); // ë³µì‚¬ ì‹¤í–‰
                window.showToast('í´ë¦¬í•‘ í…ìŠ¤íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (e) {
                console.error('ëŒ€ì²´ ë³µì‚¬ ë°©ì‹ ì‹¤íŒ¨:', e);
                alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
            // ì„ íƒ í•´ì œ
            window.getSelection()?.removeAllRanges();
        }
    });

    document.getElementById('clearTextBtn')?.addEventListener('click', () => {
        const textArea = document.getElementById('clippingTextArea');
        // index.htmlì— ì •ì˜ëœ ê¸°ë³¸ í…ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
        const defaultText = window.defaultClippedText || '';
        if (textArea) {
            textArea.value = defaultText;
            if (window.clippedTextContent !== undefined) {
                window.clippedTextContent = defaultText;
            }
        }
    });

    async function deleteClip(clipId) {
        if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        try {
            const resp = await fetch('/api/clip/' + clipId, { method: 'DELETE' });
            const j = await resp.json();
            if (j.success) {
                window.showToast('ì‚­ì œë¨');
                loadClippingsTab();
            } else {
                window.showToast('ì‚­ì œ ì‹¤íŒ¨');
            }
        } catch (e) {
            console.error(e);
        }
    }

    async function deleteAllClips() {
        if (!confirm('ì •ë§ ëª¨ë“  í´ë¦¬í•‘ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        try {
            const resp = await fetch('/api/clips/all', { method: 'DELETE' });
            const j = await resp.json();
            if (j.success) {
                window.showToast('ëª¨ë“  í´ë¦¬í•‘ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
                loadClippingsTab();
            } else {
                window.showToast('ì‚­ì œ ì‹¤íŒ¨');
            }
        } catch (e) {
            console.error(e);
        }
    }
</script>