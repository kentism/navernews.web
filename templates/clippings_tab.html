<div class="clipping-text-wrapper" style="padding: 12px; border-bottom: 2px solid #eee; margin-bottom: 12px;">
    <h3 style="margin-bottom: 10px;">í´ë¦¬í•‘ í…ìŠ¤íŠ¸</h3>
    <textarea id="clippingTextArea"
        style="width: 100%; min-height: 400px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; line-height: 1.6;"
        title="í…ìŠ¤íŠ¸ ì˜ì—­ì˜ í¬ê¸°ë¥¼ ì¡°ì •í•˜ë ¤ë©´ ì˜¤ë¥¸ìª½ í•˜ë‹¨ì˜ í•¸ë“¤ì„ ë“œë˜ê·¸í•˜ì„¸ìš”."></textarea>
    <div style="margin-top: 10px; display: flex; gap: 10px;">
        <button id="copyTextBtn"
            style="padding: 8px 16px; background: #667eea; color: #fff; border: none; border-radius: 4px; cursor: pointer;">ğŸ“‹
            í…ìŠ¤íŠ¸ ë³µì‚¬</button>
        <button id="clearTextBtn"
            style="padding: 8px 16px; background: #f0f0f0; color: #333; border: none; border-radius: 4px; cursor: pointer;">âœ¨
            ë¹„ìš°ê¸°</button>
    </div>
</div>

<script>
    // ì´ ìŠ¤í¬ë¦½íŠ¸ ë¸”ë¡ì€ loadClippingsTab()ì— ì˜í•´ ë™ì ìœ¼ë¡œ ì‚½ì…ë˜ë¯€ë¡œ, ì „ì—­ ìŠ¤ì½”í”„ì— í•¨ìˆ˜ë¥¼ ë‹¤ì‹œ í• ë‹¹í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.
    // ë‹¨, ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” ì´ ì‹œì ì— ë°”ì¸ë”©í•´ì•¼ í•©ë‹ˆë‹¤.

    // â­â­â­ í´ë¦¬í•‘ í…ìŠ¤íŠ¸ ì´ˆê¸°í™” ë° ìë™ ì €ì¥ â­â­â­
    const textArea = document.getElementById('clippingTextArea');
    if (textArea && window.clippedTextContent !== undefined) {
        textArea.value = window.clippedTextContent;

        // â­â­ í…ìŠ¤íŠ¸ ì˜ì—­ ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ localStorageì— ì €ì¥ â­â­
        textArea.addEventListener('input', () => {
            window.clippedTextContent = textArea.value;
            localStorage.setItem('clippedTextContent', textArea.value);
        });
    }
    // â­â­â­ ë³´ì™„ ë â­â­â­

    document.getElementById('copyTextBtn')?.addEventListener('click', () => {
        if (!textArea || !textArea.value) return;

        // ìµœì‹  Clipboard API (HTTPS, localhostì—ì„œë§Œ ë™ì‘)
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(textArea.value)
                .then(() => window.showToast('í´ë¦¬í•‘ í…ìŠ¤íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.'))
                .catch(err => {
                    console.error('ë³µì‚¬ ì‹¤íŒ¨:', err);
                    window.showToast('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                });
        } else {
            // êµ¬í˜• ë°©ì‹ (HTTPì—ì„œë„ ë™ì‘í•˜ëŠ” ëŒ€ì²´ ìˆ˜ë‹¨)
            try {
                textArea.select(); // í…ìŠ¤íŠ¸ ì „ì²´ ì„ íƒ
                textArea.setSelectionRange(0, 99999); // ëª¨ë°”ì¼ ê¸°ê¸° í˜¸í™˜ì„±
                document.execCommand('copy'); // ë³µì‚¬ ì‹¤í–‰
                window.showToast('í´ë¦¬í•‘ í…ìŠ¤íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (e) {
                console.error('ëŒ€ì²´ ë³µì‚¬ ë°©ì‹ ì‹¤íŒ¨:', e);
                alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
            // ì„ íƒ í•´ì œ
            window.getSelection()?.removeAllRanges();
        }
    });

    document.getElementById('clearTextBtn')?.addEventListener('click', () => {
        // index.htmlì— ì •ì˜ëœ ê¸°ë³¸ í…ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
        const defaultText = window.defaultClippedText || '';
        if (textArea) {
            textArea.value = defaultText;
            if (window.clippedTextContent !== undefined) {
                window.clippedTextContent = defaultText;
                localStorage.setItem('clippedTextContent', defaultText);
            }
        }
    });

</script>